FROM node:22-alpine

# Add development tools
RUN apk add --no-cache dumb-init curl git

WORKDIR /app

# Copy package files
COPY package.json package-lock.json* ./
COPY lib/standalone/homey-shim-pkg ./lib/standalone/homey-shim-pkg

# Install all dependencies (including dev)
RUN npm install

# Don't copy source code - it will be mounted as volume

# Expose ports (app + debugger)
EXPOSE 3000 9229

ENV NODE_ENV=development
ENV PORT=3000

# Enable Node.js debugging
ENTRYPOINT ["dumb-init", "--"]
CMD ["node", "--inspect=0.0.0.0:9229", "server.js"]
